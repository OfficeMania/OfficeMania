<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="description" content="This is the Login page.">
        <meta name="viewport" content="width=device-width" />
        <title>OfficeMania - Login</title>
        <link rel="shortcut icon" href="../assets/img/favicon.ico" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
              crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
        <script src="/js/vendors-bundle.js" defer></script>
    </head>
    <body>
        <div class="d-flex align-items-center min-vh-100">
            <div class="container" style="max-width: max(25%, 454px);">
                <div class="card">
                    <article class="card-body">
                        <a href="/auth/signup" class="btn btn-outline-primary float-end">Sign up</a>
                        <h4 class="card-title mb-4 mt-1">Login</h4>
                        <hr>
                        <p class="text-danger text-center" id="error-message" hidden>Some error message goes here</p>
                        <form id="form-login" action="/auth/login" method="post">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i class="fa fa-user"></i></span>
                                <input type="text" class="form-control" placeholder="Username" name="username"
                                       autocomplete="username" aria-label="Username" required>
                            </div>
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i class="fa fa-lock"></i></span>
                                <input type="password" class="form-control" placeholder="Password" name="password"
                                       autocomplete="current-password" aria-label="Password" required>
                            </div>
                            <button type="submit" class="col-12 btn btn-primary btn-block">Login</button>
                            <p class="text-center"><a href="/auth/forgot-password" class="btn text-primary">Forgot
                                password?</a></p>
                        </form>
                    </article>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
                crossorigin="anonymous"></script>
        <script>
            const errorMessage = document.getElementById("error-message");
            document.forms["form-login"].addEventListener("submit", (event) => {
                event.preventDefault();
                fetch(event.target.action, {
                    method: "POST",
                    body: new URLSearchParams(new FormData(event.target)),
                })
                    .then(async response => ({ status: response.status, response: await response.json() }))
                    .then(wrapper => {
                        const status = wrapper.status;
                        const response = wrapper.response;
                        if (status === 200) {
                            response.user && (window.location.href = "/");
                            return;
                        }
                        errorMessage.innerText = response.errorMessage;
                        errorMessage.hidden = false;
                    })
                    .catch(error => {
                        errorMessage.innerText = error;
                        errorMessage.hidden = false;
                    });
            });
        </script>
    </body>
</html>
